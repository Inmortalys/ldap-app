<div class="settings-container">
    <div class="header">
        <h1>‚öôÔ∏è Configuraci√≥n LDAP</h1>
    </div>

    <div *ngIf="loading" class="loading-spinner">
        <div class="spinner"></div>
        <p>Cargando configuraci√≥n...</p>
    </div>

    <div *ngIf="!loading" class="settings-form">
        <div *ngIf="error" class="message error-message">
            {{ error }}
        </div>

        <div *ngIf="success" class="message success-message">
            {{ success }}
        </div>

        <div *ngIf="testResult" class="message test-result">
            {{ testResult }}
        </div>

        <div class="form-section">
            <h2>Servidor LDAP</h2>

            <div class="form-group">
                <label for="server">Servidor *</label>
                <input id="server" type="text" [(ngModel)]="config.server" (input)="clearMessages()"
                    placeholder="ldap://servidor.ejemplo.com" class="form-input" />
                <small>Ejemplo: ldap://192.168.1.100 o ldaps://ldap.ejemplo.com</small>
            </div>

            <div class="form-group">
                <label for="port">Puerto *</label>
                <input id="port" type="number" [(ngModel)]="config.port" (input)="clearMessages()" placeholder="389"
                    class="form-input" />
                <small>Puerto est√°ndar: 389 (LDAP) o 636 (LDAPS)</small>
            </div>
        </div>

        <div class="form-section">
            <h2>Configuraci√≥n de B√∫squeda</h2>

            <div class="form-group">
                <label for="baseDN">Base DN *</label>
                <input id="baseDN" type="text" [(ngModel)]="config.baseDN" (input)="clearMessages()"
                    placeholder="dc=ejemplo,dc=com" class="form-input" />
                <small>Distinguished Name base del directorio</small>
            </div>

            <div class="form-group">
                <label for="searchBase">Search Base (Opcional)</label>
                <input id="searchBase" type="text" [(ngModel)]="config.searchBase" (input)="clearMessages()"
                    placeholder="ou=users,dc=ejemplo,dc=com" class="form-input" />
                <small>Ruta espec√≠fica para buscar usuarios. Si est√° vac√≠o, se usa Base DN</small>
            </div>
        </div>

        <div class="form-section">
            <h2>Credenciales de Administrador</h2>

            <div class="form-group">
                <label for="adminDN">Admin DN *</label>
                <input id="adminDN" type="text" [(ngModel)]="config.adminDN" (input)="clearMessages()"
                    placeholder="cn=admin,dc=ejemplo,dc=com" class="form-input" />
                <small>Distinguished Name del usuario administrador</small>
            </div>

            <div class="form-group">
                <label for="adminPassword">Contrase√±a de Administrador *</label>
                <input id="adminPassword" type="password" [(ngModel)]="config.adminPassword" (input)="clearMessages()"
                    placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="form-input" />
                <small>‚ö†Ô∏è La contrase√±a se almacena cifrada en PocketBase</small>
            </div>
        </div>

        <div class="form-actions">
            <button class="btn btn-test" (click)="testConnection()" [disabled]="testing || saving">
                <span *ngIf="!testing">üîç Probar Conexi√≥n</span>
                <span *ngIf="testing">‚è≥ Probando...</span>
            </button>

            <button class="btn btn-save" (click)="saveConfig()" [disabled]="testing || saving">
                <span *ngIf="!saving">üíæ Guardar Configuraci√≥n</span>
                <span *ngIf="saving">‚è≥ Guardando...</span>
            </button>
        </div>
    </div>

    <div class="info-section">
        <h3>‚ÑπÔ∏è Informaci√≥n</h3>
        <ul>
            <li>Esta configuraci√≥n se almacena de forma segura en PocketBase</li>
            <li>La contrase√±a del administrador se cifra antes de guardarla</li>
            <li>Los datos de PocketBase NO se suben al repositorio Git</li>
            <li>Prueba la conexi√≥n antes de guardar para verificar que los datos son correctos</li>
        </ul>
    </div>
</div>